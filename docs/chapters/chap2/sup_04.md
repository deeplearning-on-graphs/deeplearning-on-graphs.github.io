# 2.4 サポートページ
## ラプラシアン行列
ラプラシアン行列とは、グラフ理論において使用される行列で、グラフの構造を表現します。具体的には、ラプラシアン行列は隣接行列と次数行列の差により定義され、次のように表現されます：

$$
L = D - A
$$

ここで、 $A$ はグラフの隣接行列で、ノード $i$ とノード $j$ がエッジで接続されている場合、 $A_{ij} = 1$ 、そうでない場合は $A_{ij} = 0$ となります。
 $D$ は次数行列で、対角成分 $D_{ii}$ はノード $i$ に接続されているエッジの数（次数）を表し、非対角成分はすべて0です。
 
### numpy 
```python
import numpy as np

# 隣接行列の定義
A = np.array([[0, 1, 1, 0, 0, 0],
              [1, 0, 1, 1, 0, 0],
              [1, 1, 0, 1, 0, 0],
              [0, 1, 1, 0, 1, 1],
              [0, 0, 0, 1, 0, 1],
              [0, 0, 0, 1, 1, 0]])

# 各ノードの次数（接続エッジの数）を計算
D = np.diag(np.sum(A, axis=1))

# ラプラシアン行列の計算
L = D - A

print(L)
```
### networkx
```python
import numpy as np
import networkx as nx
from scipy.sparse import csr_matrix

# 隣接行列の定義
A = np.array([[0, 1, 1, 0, 0, 0],
              [1, 0, 1, 1, 0, 0],
              [1, 1, 0, 1, 0, 0],
              [0, 1, 1, 0, 1, 1],
              [0, 0, 0, 1, 0, 1],
              [0, 0, 0, 1, 1, 0]])

# numpy arrayからnetworkxのグラフオブジェクトを作成
G = nx.from_numpy_array(A, create_using=nx.DiGraph)

# ラプラシアン行列の計算
L = nx.laplacian_matrix(G).toarray()

print(L)
```

### 備考
ただし、ここでも注意が必要です。networkxのlaplacian_matrix関数は無向グラフのラプラシアン行列を返します。有向グラフのラプラシアン行列を計算する場合は、自分で関数を作成するか、他のライブラリを使用する必要があります。

有向グラフのラプラシアン行列は、無向グラフのラプラシアン行列と同じく次数行列と隣接行列の差によって定義されます。ただし、有向グラフの場合、次数行列と隣接行列はそれぞれ入次数(in-degree)と出次数(out-degree)、および有向エッジの存在を考慮した形になります。

具体的には、隣接行列Aの要素 $a_{ij}$ はノード $i$ からノード $j$ へのエッジが存在する場合に1、存在しない場合に0をとります。次に、次数行列 $D$ の対角要素 $d_{ii}$ はノード $i$ から出るエッジの数（出次数）を表します。

したがって、有向グラフのラプラシアン行列は以下のように表されます：

$$
L = D - A
$$

ただし、有向グラフのラプラシアン行列に関する理論は無向グラフの場合とは異なる特性を持つことが多く、それぞれ異なる問題設定や応用に用いられます。

なお、一部の文献やライブラリでは、有向グラフのラプラシアン行列を無向グラフと同様に定義する場合もあります。具体的な定義や計算方法は、使用するライブラリや研究の目的により異なることがあるため、注意が必要です。

## 正規化ラプラシアン行列
正規化ラプラシアン行列は、ラプラシアン行列をノードの次数で正規化したものであり、以下のように定義されます：

$$
L = D^(-1/2) (D - A) D^(-1/2) = I - D^(-1/2) A D^(-1/2)
$$

ここで、 $A$ は隣接行列、 $D$ は次数行列（各ノードの次数を対角成分にもつ対角行列）、 $I$ は単位行列を表します。
無向グラフにおける正規化ラプラシアン行列は、グラフの構造を保ちながら次数によるバイアスを減らすために用いられます。

### numpy
```python
import numpy as np

# 定数グラフの定義
A = np.array([
    [0, 1, 0, 0, 1, 1],
    [1, 0, 1, 0, 1, 0],
    [0, 1, 0, 1, 0, 0],
    [0, 0, 1, 0, 1, 1],
    [1, 1, 0, 1, 0, 0],
    [1, 0, 0, 1, 0, 0]
])

# 次数行列の計算
D = np.diag(np.sum(A, axis=1))

# 正規化ラプラシアン行列の計算
D_inv_sqrt = np.linalg.inv(np.sqrt(D))
L = np.eye(6) - D_inv_sqrt @ A @ D_inv_sqrt

print(L)
```
### networkx
```python
import networkx as nx
import numpy as np

# 定数グラフの定義
A = np.array([
    [0, 1, 0, 0, 1, 1],
    [1, 0, 1, 0, 1, 0],
    [0, 1, 0, 1, 0, 0],
    [0, 0, 1, 0, 1, 1],
    [1, 1, 0, 1, 0, 0],
    [1, 0, 0, 1, 0, 0]
])

# networkxのグラフオブジェクトに変換
G = nx.from_numpy_array(A)

# 正規化ラプラシアン行列の計算
L = nx.normalized_laplacian_matrix(G).toarray()

print(L)
```

[メインページ](../../index.markdown)

[章目次](./chap2.md)
